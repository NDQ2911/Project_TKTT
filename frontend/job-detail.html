<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Detail</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        :root {
            --primary: #1a73e8;
            --primary-hover: #1557b0;
            --secondary: #34a853;
            --accent: #fbbc04;
            --bg-white: #ffffff;
            --bg-light: #f8f9fa;
            --bg-gray: #f1f3f4;
            --text-primary: #202124;
            --text-secondary: #5f6368;
            --text-muted: #80868b;
            --border-light: #dadce0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-light);
            min-height: 100vh;
            color: var(--text-primary);
            padding: 24px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            text-decoration: none;
            margin-bottom: 24px;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .back-btn:hover {
            color: var(--primary);
            text-decoration: underline;
        }

        .job-card {
            background: var(--bg-white);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            padding: 32px;
            box-shadow: 0 1px 6px rgba(0, 0, 0, 0.1);
        }

        .job-header {
            margin-bottom: 24px;
        }

        .job-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .job-company {
            font-size: 1.2rem;
            color: var(--primary);
            margin-bottom: 16px;
        }

        .job-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .job-tag {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: var(--bg-gray);
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .source-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .source-badge.legacy {
            background: rgba(26, 115, 232, 0.1);
            color: var(--primary);
        }

        .source-badge.crawler {
            background: rgba(52, 168, 83, 0.1);
            color: var(--secondary);
        }

        .job-section {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid var(--border-light);
        }

        .job-section h3 {
            font-size: 1rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .job-section p,
        .job-section ul {
            line-height: 1.8;
            white-space: pre-wrap;
        }

        .skills-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .skill-tag {
            padding: 6px 14px;
            background: rgba(26, 115, 232, 0.1);
            border: 1px solid rgba(26, 115, 232, 0.2);
            border-radius: 20px;
            font-size: 0.85rem;
            color: var(--primary);
        }

        .job-link {
            display: inline-block;
            margin-top: 24px;
            padding: 12px 24px;
            background: var(--primary);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .job-link:hover {
            background: var(--primary-hover);
            box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: var(--text-secondary);
        }

        .error {
            text-align: center;
            padding: 60px;
            color: #ef4444;
        }
    </style>
</head>

<body>
    <header class="site-header">
        <div class="container">
            <a href="search.html" class="site-logo">üîç Job Search</a>
            <nav class="site-nav">
                <a href="search-multi.html">Search</a>
                <a href="dashboard.html">Dashboard</a>
                <a href="dashboard.html">Analytics</a>
                <a href="upload.html">Upload</a>
            </nav>
        </div>
    </header>

    <div class="container">
        <a href="search-multi.html" class="back-btn">‚Üê Quay l·∫°i t√¨m ki·∫øm</a>
        <div class="job-card" id="jobContent">
            <div class="loading">ƒêang t·∫£i...</div>
        </div>
    </div>

    <script>
        const API_URL = "http://localhost:3000";

        document.addEventListener('DOMContentLoaded', loadJob);

        async function loadJob() {
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');
            const source = params.get('source') || 'legacy';

            if (!id) {
                showError('Thi·∫øu ID c√¥ng vi·ªác');
                return;
            }

            try {
                const endpoint = source === 'crawler' ? `/api/crawler/job/${id}` : `/api/legacy/job/${id}`;
                const res = await fetch(`${API_URL}${endpoint}`);

                if (!res.ok) throw new Error('Kh√¥ng t√¨m th·∫•y c√¥ng vi·ªác');

                const data = await res.json();
                renderJob(data.data, source);
            } catch (err) {
                showError(err.message);
            }
        }

        function renderJob(job, source) {
            const content = document.getElementById('jobContent');

            if (source === 'crawler') {
                content.innerHTML = `
                    <div class="job-header">
                        <span class="source-badge crawler">${escapeHtml(job.source || 'Crawler')}</span>
                        <h1 class="job-title">${escapeHtml(job.title)}</h1>
                        <div class="job-company">${escapeHtml(job.company)}</div>
                        <div class="job-tags">
                            <span class="job-tag">üìç ${escapeHtml(job.location || (job.location_city?.join(', ')) || 'N/A')}</span>
                            <span class="job-tag">üí∞ ${escapeHtml(job.salary || 'Th·ªèa thu·∫≠n')}</span>
                            <span class="job-tag">üëî ${escapeHtml(job.experience || 'N/A')}</span>
                            <span class="job-tag">üè¢ ${escapeHtml(job.work_type || 'N/A')}</span>
                            ${job.position ? `<span class="job-tag">üìå ${escapeHtml(job.position)}</span>` : ''}
                        </div>
                    </div>

                    ${job.description ? `
                        <div class="job-section">
                            <h3>üìù M√¥ t·∫£ c√¥ng vi·ªác</h3>
                            <p>${escapeHtml(job.description)}</p>
                        </div>
                    ` : ''}

                    ${job.requirements ? `
                        <div class="job-section">
                            <h3>‚úÖ Y√™u c·∫ßu</h3>
                            <p>${escapeHtml(job.requirements)}</p>
                        </div>
                    ` : ''}

                    ${job.benefits ? `
                        <div class="job-section">
                            <h3>üéÅ Quy·ªÅn l·ª£i</h3>
                            <p>${escapeHtml(job.benefits)}</p>
                        </div>
                    ` : ''}

                    ${job.skills?.length ? `
                        <div class="job-section">
                            <h3>üíº K·ªπ nƒÉng y√™u c·∫ßu</h3>
                            <div class="skills-list">
                                ${job.skills.map(s => `<span class="skill-tag">${escapeHtml(s)}</span>`).join('')}
                            </div>
                        </div>
                    ` : ''}

                    ${job.industry?.length ? `
                        <div class="job-section">
                            <h3>üè≠ Ng√†nh ngh·ªÅ</h3>
                            <p>${job.industry.map(i => escapeHtml(i)).join(', ')}</p>
                        </div>
                    ` : ''}

                    ${job.source_url ? `
                        <a href="${job.source_url}" target="_blank" class="job-link">üîó Xem tr√™n ${job.source || 'ngu·ªìn g·ªëc'}</a>
                    ` : ''}
                `;
            } else {
                // Legacy format
                content.innerHTML = `
                    <div class="job-header">
                        <span class="source-badge legacy">Legacy Data</span>
                        <h1 class="job-title">${escapeHtml(job["Ti√™u ƒë·ªÅ tin"])}</h1>
                        <div class="job-tags">
                            <span class="job-tag">üìç ${escapeHtml(job["T·ªânh th√†nh tuy·ªÉn d·ª•ng"] || job["ƒê·ªãa ƒëi·ªÉm tuy·ªÉn d·ª•ng"] || 'N/A')}</span>
                            <span class="job-tag">üí∞ ${escapeHtml(job["M·ª©c l∆∞∆°ng"] || 'Th·ªèa thu·∫≠n')}</span>
                            <span class="job-tag">üëî ${escapeHtml(job["Kinh nghi·ªám"] || 'N/A')}</span>
                            <span class="job-tag">üè¢ ${escapeHtml(job["H√¨nh th·ª©c l√†m vi·ªác"] || 'N/A')}</span>
                            ${job["Ch·ª©c v·ª•"] ? `<span class="job-tag">üìå ${escapeHtml(job["Ch·ª©c v·ª•"])}</span>` : ''}
                        </div>
                    </div>

                    ${job["Ng√†nh ngh·ªÅ"] ? `
                        <div class="job-section">
                            <h3>üè≠ Ng√†nh ngh·ªÅ</h3>
                            <p>${escapeHtml(job["Ng√†nh ngh·ªÅ"])}</p>
                        </div>
                    ` : ''}

                    ${job["Lƒ©nh v·ª±c"] ? `
                        <div class="job-section">
                            <h3>üìÇ Lƒ©nh v·ª±c</h3>
                            <p>${escapeHtml(job["Lƒ©nh v·ª±c"])}</p>
                        </div>
                    ` : ''}
                `;
            }
        }

        function showError(message) {
            document.getElementById('jobContent').innerHTML = `
                <div class="error">
                    <p>‚ùå ${escapeHtml(message)}</p>
                    <a href="search-multi.html" class="job-link" style="margin-top: 20px;">Quay l·∫°i t√¨m ki·∫øm</a>
                </div>
            `;
        }

        function escapeHtml(str) {
            if (!str) return '';
            return String(str).replace(/[&<>"']/g, m => ({
                '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
            })[m]);
        }
    </script>
</body>

</html>